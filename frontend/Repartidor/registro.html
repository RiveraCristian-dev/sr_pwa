<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Cuenta - RutaTec</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: linear-gradient(180deg, #0a0e14 0%, #1a2332 50%, #2a3f5f 100%); color: #fff; min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .contenedor { width: 100%; max-width: 620px; }
        .cabecera-login { text-align: center; margin-bottom: 30px; }
        .logo-rutatec { width: 140px; height: 140px; background: linear-gradient(135deg, #4a90e2, #67b2e8); border-radius: 50%; margin: 0 auto 25px; box-shadow: 0 8px 32px rgba(74, 144, 226, 0.4); cursor: pointer; transition: transform 0.3s; }
        .logo-rutatec:hover { transform: scale(1.05); }
        .titulo-principal { font-size: 2.8rem; font-weight: 700; margin-bottom: 8px; color: #a8d0e6; letter-spacing: 2px; }
        .subtitulo { font-size: 1rem; color: #a8d0e6; letter-spacing: 3px; font-weight: 300; text-transform: uppercase; opacity: 0.9; }
        .contenedor-registro { background: linear-gradient(180deg, rgba(42, 63, 95, 0.95) 0%, rgba(26, 35, 50, 0.95) 100%); border-radius: 24px; padding: 40px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5); border: 2px solid rgba(91, 155, 213, 0.3); position: relative; }
        .contenedor-registro::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: linear-gradient(90deg, #4ade80, #5b9bd5, #4ade80); }
        .encabezado-registro { text-align: center; margin-bottom: 35px; padding-bottom: 20px; border-bottom: 1px solid rgba(91, 155, 213, 0.2); }
        .encabezado-registro h2 { font-size: 1.6rem; margin-bottom: 8px; display: flex; align-items: center; justify-content: center; gap: 12px; }
        .icono-titulo { width: 28px; height: 28px; background: linear-gradient(135deg, #7c3aed, #a78bfa); border-radius: 8px; display: flex; align-items: center; justify-content: center; }
        .encabezado-registro p { color: #a8d0e6; font-size: 0.95rem; opacity: 0.85; }
        .formulario-registro { display: flex; flex-direction: column; gap: 20px; }
        .fila-formulario { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .etiqueta-input { display: flex; align-items: center; gap: 8px; color: #a8d0e6; font-weight: 500; margin-bottom: 8px; font-size: 0.9rem; }
        .contenedor-input { position: relative; width: 100%; }
        .contenedor-input input, .contenedor-input select { width: 100%; padding: 14px 16px; background: #1c1f26; border: 2px solid rgba(91, 155, 213, 0.3); border-radius: 12px; color: #fff; font-size: 1rem; transition: all 0.3s; outline: none; }
        .contenedor-input input:focus, .contenedor-input select:focus { border-color: #5b9bd5; background: #1c1f26; }
        .contenedor-input input::placeholder { color: rgba(168, 208, 230, 0.4); }
        .contenedor-input select { cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%235b9bd5' d='M6 9L1 4h10z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 16px center; padding-right: 40px; }
        .boton-visibilidad { position: absolute; right: 16px; top: 50%; transform: translateY(-50%); background: transparent; border: none; color: #a8d0e6; cursor: pointer; padding: 6px; font-size: 1.1rem; border-radius: 6px; }
        .boton-visibilidad:hover { color: #5b9bd5; background: rgba(91, 155, 213, 0.1); }
        .indicador-fuerza { margin-top: 8px; height: 4px; border-radius: 2px; background: rgba(28, 31, 38, 0.8); overflow: hidden; }
        .barra-fuerza { height: 100%; width: 0%; border-radius: 2px; transition: all 0.3s; background: #ef4444; }
        .fuerza-texto { margin-top: 4px; font-size: 0.8rem; color: #a8d0e6; text-align: right; opacity: 0.8; }
        .terminos { margin-top: 15px; }
        .terminos label { display: flex; align-items: flex-start; gap: 10px; color: #a8d0e6; font-size: 0.85rem; cursor: pointer; line-height: 1.5; }
        .terminos input[type="checkbox"] { margin-top: 3px; width: 18px; height: 18px; accent-color: #5b9bd5; cursor: pointer; flex-shrink: 0; }
        .enlace-terminos { color: #5b9bd5; text-decoration: none; }
        .enlace-terminos:hover { text-decoration: underline; }
        .boton-registro { background: linear-gradient(135deg, #5b9bd5, #4a90e2); color: #fff; border: none; padding: 16px 40px; border-radius: 12px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 12px; margin-top: 25px; width: 100%; text-transform: uppercase; letter-spacing: 1px; }
        .boton-registro:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(74, 144, 226, 0.4); }
        .boton-registro:disabled { opacity: 0.5; cursor: not-allowed; }
        .boton-registro::after { content: "‚úì"; font-size: 1.2rem; }
        .boton-registro.cargando::after { content: ""; width: 18px; height: 18px; border: 2px solid rgba(255,255,255,0.3); border-top-color: #fff; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .contenedor-inicio-sesion { text-align: center; margin-top: 25px; padding-top: 25px; border-top: 1px solid rgba(91, 155, 213, 0.2); }
        .texto-inicio-sesion { color: #a8d0e6; font-size: 0.95rem; margin-bottom: 12px; opacity: 0.9; }
        .enlace-inicio-sesion { color: #a8d0e6; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; font-size: 1rem; padding: 10px 24px; background: rgba(26, 35, 50, 0.6); border-radius: 10px; border: 1px solid rgba(91, 155, 213, 0.3); transition: all 0.3s; font-weight: 500; }
        .enlace-inicio-sesion:hover { color: #5b9bd5; background: rgba(26, 35, 50, 0.9); border-color: #5b9bd5; transform: translateY(-2px); }
        .enlace-inicio-sesion::before { content: "‚Üê"; transition: transform 0.3s; }
        .enlace-inicio-sesion:hover::before { transform: translateX(-3px); }
        .mensaje-estado { padding: 14px 18px; border-radius: 10px; margin-bottom: 20px; display: none; align-items: center; gap: 12px; font-size: 0.95rem; }
        .mensaje-estado.error { background: rgba(239, 68, 68, 0.15); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3); display: flex; }
        .mensaje-estado.error::before { content: "‚úï"; font-size: 1.2rem; }
        .mensaje-estado.exito { background: rgba(74, 222, 128, 0.15); color: #4ade80; border: 1px solid rgba(74, 222, 128, 0.3); display: flex; }
        .mensaje-estado.exito::before { content: "‚úì"; font-size: 1.2rem; }
        .pie-pagina { margin-top: 40px; text-align: center; color: #a8d0e6; font-size: 0.85rem; opacity: 0.7; }
        @media (max-width: 768px) { .fila-formulario { grid-template-columns: 1fr; } .contenedor-registro { padding: 30px 25px; } .titulo-principal { font-size: 2.2rem; } }
        @media (max-width: 480px) { .logo-rutatec { width: 110px; height: 110px; } .titulo-principal { font-size: 1.8rem; } .contenedor-registro { padding: 25px 20px; } }
    </style>
</head>
<body>
    <div class="contenedor">
        <header class="cabecera-login">
            <div class="logo-rutatec"></div>
            <h1 class="titulo-principal">RutaTec</h1>
            <p class="subtitulo">CREAR NUEVA CUENTA</p>
        </header>
        
        <div class="contenedor-registro">
            <div class="encabezado-registro">
                <h2><span class="icono-titulo">üë§</span>Registro de Usuario</h2>
                <p>Completa el formulario para crear tu cuenta en RutaTec</p>
            </div>
            
            <div class="mensaje-estado" id="mensajeEstado"></div>
            
            <form id="formularioRegistro" class="formulario-registro">
                <div class="fila-formulario">
                    <div class="grupo-formulario">
                        <label class="etiqueta-input" for="nombre"><span>üë§</span>Nombre Completo</label>
                        <div class="contenedor-input">
                            <input type="text" id="nombre" placeholder="Ej: Juan P√©rez" required>
                        </div>
                    </div>
                    <div class="grupo-formulario">
                        <label class="etiqueta-input" for="email"><span>üìß</span>Correo Electr√≥nico</label>
                        <div class="contenedor-input">
                            <input type="email" id="email" placeholder="ejemplo@correo.com" required>
                        </div>
                    </div>
                </div>
                
                <div class="fila-formulario">
                    <div class="grupo-formulario">
                        <label class="etiqueta-input" for="telefono"><span>üì±</span>Tel√©fono</label>
                        <div class="contenedor-input">
                            <input type="tel" id="telefono" placeholder="55 70811606">
                        </div>
                    </div>
                    <div class="grupo-formulario">
                        <label class="etiqueta-input" for="rol"><span>üë•</span>Tipo de Usuario</label>
                        <div class="contenedor-input">
                            <select id="rol" required>
                                <option value="">Selecciona un rol</option>
                                <option value="repartidor">Repartidor</option>
                                <option value="admin">Administrador</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="grupo-formulario">
                    <label class="etiqueta-input" for="usuario"><span>üîë</span>Nombre de Usuario</label>
                    <div class="contenedor-input">
                        <input type="text" id="usuario" placeholder="usuario123" required minlength="3">
                    </div>
                </div>
                
                <div class="fila-formulario">
                    <div class="grupo-formulario">
                        <label class="etiqueta-input" for="contrasena"><span>üîí</span>Contrase√±a</label>
                        <div class="contenedor-input">
                            <input type="password" id="contrasena" placeholder="M√≠nimo 8 caracteres" required>
                            <button type="button" class="boton-visibilidad" data-target="contrasena">üëÅÔ∏è</button>
                        </div>
                        <div class="indicador-fuerza"><div class="barra-fuerza" id="barraFuerza"></div></div>
                        <div class="fuerza-texto" id="fuerzaTexto">Fuerza: Media</div>
                    </div>
                    <div class="grupo-formulario">
                        <label class="etiqueta-input" for="confirmar"><span>üîí</span>Confirmar Contrase√±a</label>
                        <div class="contenedor-input">
                            <input type="password" id="confirmar" placeholder="Repite tu contrase√±a" required>
                            <button type="button" class="boton-visibilidad" data-target="confirmar">üëÅÔ∏è</button>
                        </div>
                    </div>
                </div>
                
                <div class="terminos">
                    <label>
                        <input type="checkbox" id="aceptarTerminos" required>
                        <span>Acepto los <a href="#" class="enlace-terminos" onclick="event.preventDefault(); mostrarTerminos()">t√©rminos y condiciones</a> y la <a href="#" class="enlace-terminos" onclick="event.preventDefault(); mostrarPrivacidad()">pol√≠tica de privacidad</a> de RutaTec</span>
                    </label>
                </div>
                
                <button type="submit" class="boton-registro" id="botonRegistro">Crear Cuenta</button>
            </form>
            
            <div class="contenedor-inicio-sesion">
                <p class="texto-inicio-sesion">¬øYa tienes una cuenta?</p>
                <a href="Iniciar-secion.html" class="enlace-inicio-sesion">Iniciar Sesi√≥n</a>
            </div>
        </div>
        
        <div class="pie-pagina">
            <p>¬© 2025 RutaTec - Sistema de Optimizaci√≥n Log√≠stica</p>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000/api';
        const formulario = document.getElementById('formularioRegistro');
        const mensajeEstado = document.getElementById('mensajeEstado');
        const botonRegistro = document.getElementById('botonRegistro');
        const barraFuerza = document.getElementById('barraFuerza');
        const fuerzaTexto = document.getElementById('fuerzaTexto');

        function mostrarMensaje(texto, tipo) {
            mensajeEstado.textContent = texto;
            mensajeEstado.className = `mensaje-estado ${tipo}`;
            mensajeEstado.style.display = 'flex';
            if (tipo === 'error') setTimeout(() => mensajeEstado.style.display = 'none', 5000);
        }

        function validarEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function verificarFuerzaContrasena(pass) {
            let f = 0;
            if (pass.length >= 8) f += 20;
            if (pass.length >= 12) f += 10;
            if (/[A-Z]/.test(pass)) f += 20;
            if (/[a-z]/.test(pass)) f += 20;
            if (/[0-9]/.test(pass)) f += 20;
            if (/[^A-Za-z0-9]/.test(pass)) f += 10;
            return Math.min(f, 100);
        }

        function actualizarIndicadorFuerza(pass) {
            const f = verificarFuerzaContrasena(pass);
            barraFuerza.style.width = `${f}%`;
            if (f < 40) { barraFuerza.style.background = '#ef4444'; fuerzaTexto.textContent = 'Fuerza: D√©bil'; }
            else if (f < 70) { barraFuerza.style.background = '#fb923c'; fuerzaTexto.textContent = 'Fuerza: Media'; }
            else { barraFuerza.style.background = '#4ade80'; fuerzaTexto.textContent = 'Fuerza: Fuerte'; }
        }

        async function registrarUsuario(datos) {
            try {
                const res = await fetch(`${API_URL}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        nombre_completo: datos.nombre,
                        email: datos.email,
                        telefono: datos.telefono || null,
                        username: datos.usuario,
                        password: datos.contrasena,
                        rol: datos.rol
                    })
                });
                const result = await res.json();
                if (!res.ok) throw new Error(result.detail || 'Error en el registro');
                return { exito: true, datos: result };
            } catch (error) {
                return { exito: false, mensaje: error.message };
            }
        }

        document.querySelectorAll('.boton-visibilidad').forEach(btn => {
            btn.addEventListener('click', function() {
                const input = document.getElementById(this.getAttribute('data-target'));
                const tipo = input.type === 'password' ? 'text' : 'password';
                input.type = tipo;
                this.textContent = tipo === 'password' ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è';
            });
        });

        document.getElementById('contrasena').addEventListener('input', (e) => actualizarIndicadorFuerza(e.target.value));

        formulario.addEventListener('submit', async function(e) {
            e.preventDefault();
            const datos = {
                nombre: document.getElementById('nombre').value.trim(),
                email: document.getElementById('email').value.trim(),
                telefono: document.getElementById('telefono').value.trim(),
                rol: document.getElementById('rol').value,
                usuario: document.getElementById('usuario').value.trim(),
                contrasena: document.getElementById('contrasena').value,
                confirmar: document.getElementById('confirmar').value
            };

            if (!datos.nombre) return mostrarMensaje('Ingresa tu nombre completo', 'error');
            if (!validarEmail(datos.email)) return mostrarMensaje('Email inv√°lido', 'error');
            if (!datos.rol) return mostrarMensaje('Selecciona un tipo de usuario', 'error');
            if (datos.usuario.length < 3) return mostrarMensaje('Usuario debe tener 3+ caracteres', 'error');
            if (datos.contrasena.length < 8) return mostrarMensaje('Contrase√±a debe tener 8+ caracteres', 'error');
            if (datos.contrasena !== datos.confirmar) return mostrarMensaje('Las contrase√±as no coinciden', 'error');
            if (!document.getElementById('aceptarTerminos').checked) return mostrarMensaje('Acepta los t√©rminos', 'error');

            botonRegistro.disabled = true;
            botonRegistro.classList.add('cargando');

            const resultado = await registrarUsuario(datos);

            if (resultado.exito) {
                mostrarMensaje('¬°Cuenta creada! Redirigiendo...', 'exito');
                setTimeout(() => window.location.href = 'Iniciar-secion.html?registro=exitoso', 2000);
            } else {
                mostrarMensaje(resultado.mensaje, 'error');
                botonRegistro.disabled = false;
                botonRegistro.classList.remove('cargando');
            }
        });

        function mostrarTerminos() {
            alert('T√©rminos y Condiciones de RutaTec\n\n1. Uso responsable del sistema\n2. Informaci√≥n ver√≠dica\n3. Suspensi√≥n por violaci√≥n de pol√≠ticas');
        }

        function mostrarPrivacidad() {
            alert('Pol√≠tica de Privacidad de RutaTec\n\n1. Datos protegidos\n2. No compartimos con terceros\n3. Solicita eliminaci√≥n cuando quieras');
        }

        document.addEventListener('DOMContentLoaded', function() {
            const params = new URLSearchParams(window.location.search);
            if (params.get('registro') === 'exitoso') mostrarMensaje('¬°Bienvenido! Inicia sesi√≥n', 'exito');
            console.log('‚úÖ Sistema conectado:', API_URL);
        });
    </script>
</body>
</html>